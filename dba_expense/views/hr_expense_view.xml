<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--Chnage Product string to Expense Term-->
	<record id="hr_expense_hr_expense_form_view_dba" model="ir.ui.view">
        <field name="name">hr_expense.form.view.extended</field>
        <field name="model">hr.expense</field>
        <field name="inherit_id" ref="hr_expense.hr_expense_form_view"/>
        <field name="arch" type="xml">
        	<field name="company_id" position="after">
        		<field name="manager_id" groups="dba_ar_modify.group_accountant_dba" attrs="{'readonly':[('submit_to_accountant','=',True)]}"/>
        		<field name="submit_to_accountant"/>
        		<field name="paid_by" groups="dba_ar_modify.group_accountant_dba" attrs="{'readonly':[('submit_to_accountant','=',True)]}"/> 
        		<field name="cheque_no" attrs="{'invisible': [('paid_by', '=','Cash')],'readonly':[('submit_to_accountant','=',True)]}" groups="dba_ar_modify.group_accountant_dba"/> 
        	</field>
        
        	<field name="tax_ids" position="after">
        		<field name="pc_no" groups="dba_ar_modify.group_accountant_dba" attrs="{'readonly':[('submit_to_accountant','=',True)]}"/> 
        	</field>
        	<button name="submit_expenses" position="attributes">
        	    <attribute name="groups">dba_ar_modify.group_accountant_dba</attribute>
        	    <attribute name="string">Submit To Approver</attribute>
        	</button>
        	<xpath expr='//form/header/button[@name="submit_expenses"]' position='after'>
        		<button name="submit_to_account" string="Submit" 
        		type="object" class="oe_highlight o_expense_submit"
        		attrs="{'invisible':[('submit_to_accountant','=',True)]}"/>
        	</xpath>
        	<field name="product_uom_id" position="replace">
        	    <br/>
        		<field name="product_uom_id" widget="selection" class="oe_inline" groups="product.group_uom" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>

			<field name="product_id" position="replace">
        		<field name="product_id" context="{'default_can_be_expensed': 1}" attrs="{'readonly': [('submit_to_accountant', '=', True)]}" string="Expense Item"/>
        	</field>
			<field name="unit_amount" position="replace">
        		<field name="unit_amount" required="1" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
			<field name="tax_ids" position="replace">
        		<field name="tax_ids" domain="[('type_tax_use', '=', 'purchase')]" widget="many2many_tags" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
			<field name="reference" position="replace">
        		<field name="reference" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
			<field name="date" position="replace">
        		<field name="date" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
			<field name="account_id" position="replace">
        		<field name="account_id" 
        		        attrs="{'readonly': [('submit_to_accountant', '=', True)]}" 
        	 groups="dba_ar_modify.group_manager_dba,dba_ar_modify.group_accountant_dba"/>
        	</field>
			<field name="employee_id" position="replace">
        		<field name="employee_id" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
			<field name="sheet_id" position="replace">
        		<field name="sheet_id" invisible="1" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
			<field name="currency_id" position="replace">
        		<field name="currency_id" attrs="{'readonly': [('submit_to_accountant', '=', True)]}" groups="base.group_multi_currency"/>
        	</field>
			<field name="analytic_account_id" position="replace">
        		<field name="analytic_account_id" attrs="{'readonly': [('submit_to_accountant', '=', True)]}" groups="analytic.group_analytic_accounting" string="Project Code"/>
        	</field>
			<field name="company_id" position="replace">
        		<field name="company_id" attrs="{'readonly': [('submit_to_accountant', '=', True)]}" groups="base.group_multi_company"/>
        	</field>
        	<field name="quantity" position="replace">
        	    <field name="quantity" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
        	<field name="payment_mode" position="replace">
        	    <field name="payment_mode" widget="radio" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
        	<field name="description" position="replace">
        	    <field name="description" placeholder="Notes..." attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
        	<field name="name" position="replace">
        	    <field name="name" placeholder="e.g. Lunch with Customer" attrs="{'readonly': [('submit_to_accountant', '=', True)]}"/>
        	</field>
		</field>
    </record>
    
    <record id="hr_expense_submit_to_account" model="ir.actions.act_window">
            <field name="name">To be Approve by Accountant</field>
            <field name="res_model">hr.expense</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,kanban,pivot,graph</field>
            <field name="domain">[('submit_to_accountant', '=', True)]</field>
    </record>
    
    <record id="hr_expense_view_expenses_tree_dba" model="ir.ui.view">
        <field name="name">hr.expense.view.expenses.tree.dba</field>
        <field name="model">hr.expense</field>
        <field name="inherit_id" ref="hr_expense.view_expenses_tree"/>
        <field name="arch" type="xml">
        	<xpath expr='//field[@name="analytic_account_id"]' position='attributes'>
        		<attribute name="string">Project Code</attribute>
        	</xpath>
		</field>
    </record>
    
    
    <record id="product_product_expense_form_view_dba" model="ir.ui.view">
        <field name="name">product.product.expense.form</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="hr_expense.product_product_expense_form_view"/>
        <field name="arch" type="xml">
        	<xpath expr='//form/sheet/group/group/field[@name="supplier_taxes_id"]' position='after'>
        		<field name="expense_limit"/>
        	</xpath>
		</field>
    </record>
    <record id="hr_expense.hr_expense_submit_action_server" model="ir.actions.server">
            <field name="name">Submit To Approver</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_hr_expense"/>
            <field name="state">code</field>
            <field name="code">
if records:
    action = records.submit_expenses()
            </field>
        </record>    
        <!--Override the default expense action to remove the filter user-wise-->
        <record id="hr_expense.hr_expense_actions_my_unsubmitted" model="ir.actions.act_window">
            <field name="name">My Expenses to Submit</field>
            <field name="res_model">hr.expense</field>
            <field name="view_mode">tree,kanban,form,graph,pivot</field>
            <field name="search_view_id" ref="hr_expense.view_hr_expense_filter"/>
            <field name="context">{'search_default_to_report': 1,'search_default_my_expenses':1}</field>
            <field name="help" type="html">
              <p>
                The steps to process expenses are:
                <ol>
                    <li>You record expenses,</li>
                    <li>Periodically, you submit expenses report to your manager,</li>
                    <li>Once approved, your expense report, goes to the accounting,</li>
                    <li>The accountant validates entries and reimburse you.</li>
                </ol>
              </p>
            </field>
        </record>
        <!--Override the search-view-->
       <record id="hr_expense.view_hr_expense_filter" model="ir.ui.view">
            <field name="name">hr.expense.filter</field>
            <field name="model">hr.expense</field>
            <field name="arch" type="xml">
                <search string="Expense">
                    <field name="name" string="Expenses"/>
                    <field name="date"/>
                    <field name="employee_id"/>
                    <field name="product_id"/>
                    <field name="analytic_account_id" groups="analytic.group_analytic_accounting"/>
                    <separator />
                    <filter domain="[('state', '=', 'draft')]" string="To Submit" name="to_report" help="New Expense"/>
                    <filter domain="[('state', '=', 'reported')]" string="Reported" name="submitted" help="Confirmed Expenses"/>
                    <filter domain="[('state', '=', 'refused')]" string="Refused" name="refused" help="Refused Expenses"/>
                    <filter domain="[('state', '!=', 'cancel')]" string="Not Refused" name="uncancelled" help="Actual expense sheets, not the refused ones"/>
                    <separator />
                    <filter string="My Team Expenses" domain="[('employee_id.parent_id.user_id', '=', uid)]" groups="hr_expense.group_hr_expense_manager" help="Expenses of Your Team Member"/>
                    <filter name="my_expenses" string="My Expenses" domain="[('employee_id.user_id', '=', uid)]"/>
                    <separator />
                    <filter string="New Mail" name="message_unread" domain="[('message_unread', '=', True)]"/>
                    <group expand="0" string="Group By">
                        <filter string="Report" domain="[]" context="{'group_by': 'sheet_id'}"/>
                        <filter string="Employee" domain="[]" context="{'group_by': 'employee_id'}"/>
                        <filter string="Company" domain="[]" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
                        <filter string="Product" domain="[]" context="{'group_by': 'product_id'}"/>
                        <filter string="Analytic Account" domain="[]" context="{'group_by': 'analytic_account_id'}" groups="analytic.group_analytic_accounting"/>
                        <filter string="Expenses Month" domain="[]" context="{'group_by': 'date'}" help="Expenses by Month"/>
                        <filter string="Status" domain="[]" context="{'group_by': 'state'}"/>
                    </group>
                    <separator />
                    <filter domain="[('employee_id.active', '=', False)]" string="Former Employees" name="inactive" groups="hr_expense.group_hr_expense_user,hr_expense.group_hr_expense_manager"/>
                </search>
            </field>
        </record>
        

</odoo>

